{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"blog/","title":"Rockin' Blog","text":"<p>This blog is open to community contributions!</p>"},{"location":"lab/","title":"The \"Lore\"","text":"<p>In an effort to be more engaging (and keep my ADHD-brain happy), there's some lore for the lab.</p> <p>The reader/analyst is a new hire for a secretive biolab startup. Without a care in the world for branding, they simply call themselves \"The Lab.\" While chasing their dreams of becoming the destination for scientific research of space-organisms, they put cybersecurity (and IT, generally) on the backburner.</p> <p>We've been brought in to work on improving the situation.</p>"},{"location":"lab/01%20-%20Introduction/","title":"Introduction","text":"<p>Welcome to The Lab. We don't have a fun acronym, and we're struggling to trademark such a common word, but no matter. We're excited to have you on our cybersecurity team.</p> <p>The Lab is dedicated to scientific research of organisms in space, including so-described \"aliens.\" </p> <p>Our network is rather small but growing. Our sole administrator, John Williams, is entirely responsible for cybersecurity. Except for you now, of course. John has provided you a network topology. It confuses me but that's why we pay you the big bucks!</p> <p>A few things our CIO, Gregory Luckus, wanted you to know before you get inundated with paperwork from HR:</p> <ul> <li>Uptime is critical to our mission. We can't have systems turning off willy nilly or being interrupted in the middle of calculations.</li> <li>Gregory said were sold Splunk by our former third-party SOC, but we have since realized that Elastic is free. I assume those words mean something to you. Free is probably a good thing.</li> <li>Our cyber insurance is expensive and we would like to get rid of it. That's why you're here! You're our insurance, I suppose!</li> </ul> <p>Best of luck.</p> <p>Info</p> <p>I work on these scenarios for my own education when I have downtime during work hours as training, or when I'm bored at home as fun. Please suspend your disbelief for large gaps between timestamps. Sometimes I set this down for weeks and come back to it. If it helps, think of it as the adversary dwelling in the environment! :)</p>"},{"location":"lab/02%20-%20Topology/","title":"The Lab's Topology","text":"<p>The Lab's network is indeed ever changing. The CIO throws money at us for hardware, but rarely ever budgets time for software maintenance or security reviews. Until I made this network topology, nobody had ever run a network scan. Mind you, this was made on a Friday afternoon so it's really a \"point in time\" map...</p> <pre><code>&lt;&lt;+------------+------------------------+-------+--------------+\n| PROXMOX ID |        VM NAME         | POWER |      IP      |\n+------------+------------------------+-------+--------------+\n|    107     | jt-router-debian11-x64 |  On   | 10.2.20.254  |\n|    108     | jt-svr22-01            |  On   | 10.2.20.3    |\n|    109     | jt-splunk              |  On   | 10.2.20.1    |\n|    110     | jt-w11-01              |  On   | 10.2.20.4    |\n|    111     | jt-ub-01               |  On   | 10.2.20.50   |\n|    112     | jt-kali                |  On   | 10.2.100.100 |\n|    113     | jt-rustdesk            |  On   | 10.2.100.200 |\n|    114     | jt-elastic             |  On   | 10.2.20.2    |\n+------------+------------------------+-------+--------------+&gt;&gt;\n</code></pre> <p>What's Proxmox?</p> <p>Proxmox is a virtualization software, like VMware. Proxmox assigns IDs to each virtual machine. The IDs rarely change, and can be a good way to track devices even if their IPs change.</p> <p>The <code>10.2.20.0/24</code> subnet is where almost everything lives. You'll see workstations come and go as employees do.</p> <ul> <li>Before we went our separate ways, we got the MSSP to set up Elastic. I don't think it's ready for prime time yet. I don't know if anyone's reviewing the alerts. I guess you could.</li> <li>We use <code>ub-01</code> as a data analytics server, most people have access, but I know Gregory was using it for something too. Volcano...? Whatever that is.</li> <li>As you asked, I made <code>10.2.20.55</code> and named it <code>velociraptor</code>. Do with it what you want to.</li> </ul> <p>I made this <code>10.2.100.0/24</code> subnet to isolate the guest WiFi but the isolation isn't exactly what I was hoping for. I need to do some more work on it. I also join any new hardware I'm testing, like phones or new Microsoft tablets, to this WiFi before I set them up with our software!</p> <p>A firewall, you ask...? Well we don't have anything open to the internet, so I never really set much of one up. <code>10.2.20.254</code> has some basic firewall capabilities, like blocking domains, but it's really not a firewall. Maybe we should set one up.</p> <p>Anyway, your credentials are below. They're the same for every new hire, so don't go logging into someone else's account! Mr. Luckus asked me to have you prioritize fixing that.</p> <pre><code>User: lskiwalker\nPassword: password\n\nAdmin user: admlskiwalker\nPassword: password\n</code></pre>"},{"location":"lab/02%20-%20Topology/#building-the-lab-ludus","title":"Building the Lab: Ludus","text":"<p>My homelab, aka \"The Lab\" (okay, maybe I need to work on the name) is built with Ludus. It's using several <code>roles</code> but perhaps most central is the Splunk attack range role. It's very similar to the standalone Splunk attack range project.</p> <p>The linked documents will get you very far. The process looks something like this:</p> <ul> <li>SSH into the Ludus server (<code>ssh user@@192.168.10.10</code>)</li> <li>Set API key: <code>export LUDUS_API_KEY='here'</code></li> <li>Add the roles:</li> </ul> <pre><code>ludus ansible roles add p4t12ick.ludus_ar_splunk\nludus ansible roles add p4t12ick.ludus_ar_windows\nludus ansible roles add p4t12ick.ludus_ar_linux\n</code></pre> <ul> <li>Build the Ubuntu 22.04 template:</li> </ul> <pre><code>git clone https://gitlab.com/badsectorlabs/ludus\ncd ludus/templates\nludus templates add -d ubuntu-22.04-x64-server\nludus templates build\n# Wait until the templates finish building, you can monitor them with \n# `ludus templates logs -f` or `ludus templates status`\n</code></pre> <ul> <li>Assign the <code>p4t12ick.ludus_ar_splunk</code> role to an Ubuntu VM to HOST Splunk</li> <li><code>p4t12ick.ludus_ar_windows</code> </li> <li><code>p4t12ick.ludus_ar_linux</code> for Linux clients</li> </ul> <p>The deployment usually looks something like this:</p> <ul> <li><code>ludus range config set -f myconfig.yml</code></li> <li><code>ludus range deploy</code> &amp;&amp; <code>ludus range logs -f</code> to keep an eye on it</li> <li>If/when something goes wrong, <code>ludus range deploy -t user-defined-roles</code></li> <li><code>ludus range deploy -t share</code></li> </ul> <p>Repeating the <code>user-defined-roles</code> line is often required. If one host is giving me particular problems, I can exclude it by using <code>ludus range deploy -t user-defined-roles --limit &lt;comma separated hosts EXCLUDING the problem host&gt;</code>.</p>"},{"location":"lab/02%20-%20Topology/#lab-config","title":"Lab Config","text":"<p>The latest version of my lab configuration is here.</p> <p>Additional tweaks are described below.</p>"},{"location":"lab/02%20-%20Topology/#bad-blood","title":"Bad Blood","text":"<p>Bad Blood runs. The values are randomized.</p>"},{"location":"lab/02%20-%20Topology/#sysmon-changes","title":"Sysmon Changes","text":"<p>I'm using various editions of Sysmon Modular instead of SwiftOnSecurity's config that Attack Range ships with.</p>"},{"location":"lab/02%20-%20Topology/#enhanced-logging","title":"Enhanced Logging","text":"<p>Multiple components of Ludus enhance logging (e.g., the Attack Range role modifies Powershell logging), but I've added yet another layer. This script from Yamato-Security acts as my \"main\" configuration.</p> <p>Windows systems should have at least this configuration, regardless of being domain joined or not. Anything over-and-beyond is great, but this is the baseline.</p> <p>I made the following changes from the script linked above:</p> <pre><code>:: Sysmon can be just over 16GB\nwevtutil sl Microsoft-Windows-Sysmon/Operational /ms:17179869184\n\n:: No other changes at this time\n</code></pre>"},{"location":"lab/02%20-%20Topology/#disabling-defender","title":"Disabling Defender","text":"<p>I have yet to learn how to be a hacker at all, let alone one that can bypass or tamper with Defender. For now, I disable it via GPO (on top of the Ludus <code>disable-defender</code> GPO seen in the config. The Ludus one doesn't seem to work 100% of the time? That's very possibly a me thing, though).</p> <ul> <li>Computer Configuration -&gt; Policies -&gt; Administrative Templates -&gt; Windows Components -&gt; <code>Microsoft Defender Antivirus</code></li> <li><code>Turn off Microsoft Defender Antivirus</code>: Enabled</li> <li><code>Turn off routine remediation</code>: Enabled</li> <li><code>Real-Time Protection</code> subfolder:<ul> <li><code>Turn off real-time protection</code>: Enabled</li> <li><code>Turn on script scanning</code>: Disabled</li> <li><code>Turn on behavior monitoring</code>: Disabled</li> <li><code>Scan all downloaded files and attachments</code>: Disabled</li> </ul> </li> <li><code>Exclusions</code> subfolder:<ul> <li><code>Path Exclusions</code>: Enabled</li> <li>Add <code>C:\\</code> as an exception. Value name: <code>C:\\</code> and value: <code>0</code></li> </ul> </li> </ul>"},{"location":"lab/02%20-%20Topology/#various-powershell-tweaks","title":"Various Powershell Tweaks","text":"<ul> <li>Computer Configuration -&gt; Policies -&gt; Administrative Templates -&gt; Windows Components -&gt; Windows Powershell</li> <li><code>Turn on module logging</code>: Enabled<ul> <li>Set <code>*</code> as the module name(s) to track</li> </ul> </li> <li><code>Turn on PowerShell Script Block Logging</code>: Enabled<ul> <li>Check <code>Log script block invocation start/stop events</code></li> </ul> </li> <li><code>Turn on Script Execution</code>: Enabled<ul> <li>Set preferred policy</li> </ul> </li> <li><code>Turn on Powershell Transcription</code>: Enabled<ul> <li>Transcript output directory: <code>C:\\PowershellTranscripts</code> or preferred</li> <li>Check <code>include invocation headers</code></li> </ul> </li> </ul>"},{"location":"lab/02%20-%20Topology/#multiple-rdp-users-logged-in-at-once","title":"Multiple RDP Users Logged in at Once","text":"<p>Without this, there's a 60s waiting period when you RDP in and someone else is logged in. It prompts them to confirm/deny before kicking them after 60s, so you can get in.</p> <ul> <li>Computer Configuration -&gt; Policies -&gt; Administrative Templates -&gt; Windows Components -&gt; Remote Desktop Services -&gt; Remote Desktop Session Host -&gt; Connections</li> <li><code>Restrict Remote Desktop Services user to a single Remote Desktop Services</code>: Disabled</li> <li><code>Limit number of connections</code>: <code>999999</code></li> </ul>"},{"location":"lab/02%20-%20Topology/#network-shares","title":"Network Shares","text":"<p>There are (at least) three network shares:</p> <ul> <li><code>readonlyshare</code> </li> <li><code>readwriteshare</code></li> <li><code>labratoryshare</code></li> </ul> <p>The first two are convenience shares that Ludus provides. They won't be used for malice, but will be used for convenience/centralization of resources. On the other hand, <code>labratoryshare</code> is \"in scope\" for our adversary.</p> <p>Tip</p> <p>For a \"lore-friendly\" explanation, we can assume the adversary never found out about the <code>read</code> shares, or they had no interest in them.</p> <p>The <code>read</code> shares have, among other things:</p> <ul> <li>A Velociraptor offline collector doing KAPE triage collections</li> <li>Sysmon binaries + config files</li> <li>Misc. installers</li> </ul>"}]}